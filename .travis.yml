sudo: require
language: cpp
compiler: gcc

before_install:
  - sudo add-apt-repository --yes ppa:marutter/rrutter 
  - sudo apt-get update -qq

install: 
  - sudo apt-get install -qq r-base r-base-dev --force-yes
  - sudo apt-get install -qq texlive
  - sudo pip install codecov
  - ./install_beast2.sh

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test

before_script:
 - sudo Rscript install_r_packages.R
 # R wants all hidden files gone...
 - rm .gitignore
 - rm .travis.yml
 - rm -rf .git
 - rm -rf ..Rcheck
 - rm .Rprofile

script: 
 - R CMD check .

after_success:
 - sudo Rscript install_this_r_package.R
 - Rscript -e 'library(Cer2016); testit::assert(has_beast2())'
 - Rscript -e 'lintr::lint_package()'
 - Rscript -e 'library(covr); codecov()'
 - cat /home/travis/build/richelbilderbeek/Cer2016/..Rcheck/00install.out
 - cat /home/travis/build/richelbilderbeek/Cer2016/..Rcheck/00check.log
 - cd ~; find . | egrep "beast"
 - cd ~; find . | egrep "\.log"
 - cd ~; find . | egrep "\.trees"
 - cat /home/travis/build/richelbilderbeek/Cer2016/..Rcheck/tests/testthat/testthat.log
 
after_failure:
 - sudo Rscript install_this_r_package.R
 - Rscript -e 'library(Cer2016); testit::assert(has_beast2())'
 - Rscript -e 'lintr::lint_package()'
 - Rscript -e 'library(covr); codecov()'
 - cat /home/travis/build/richelbilderbeek/Cer2016/..Rcheck/00install.out
 - cat /home/travis/build/richelbilderbeek/Cer2016/..Rcheck/00check.log
 - cd ~; find . | egrep "beast"
 - cd ~; find . | egrep "\.log"
 - cd ~; find . | egrep "\.trees"
 - cat /home/travis/build/richelbilderbeek/Cer2016/..Rcheck/tests/testthat/testthat.log
