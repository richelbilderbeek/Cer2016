sudo: require
language: cpp
compiler: gcc

before_install:
  - sudo add-apt-repository --yes ppa:marutter/rrutter # R
  - sudo add-apt-repository --yes ppa:webupd8team/java # Java 8
  - sudo apt-get update -qq

install: 
  - sudo apt-get install -qq r-base r-base-dev --force-yes # R
  - sudo apt-get install -qq pandoc # pandoc
  - sudo apt-get install -qq pandoc-citeproc # pandoc
  - sudo apt-get install -qq texlive-full # LyX
  - sudo apt-get install -qq oracle-java8-installer # Java 8
  - sudo apt-get install oracle-java8-set-default
  - sudo pip install codecov
  - ./install_beast2.sh
  - pandoc -v

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test

before_script:
 - sudo Rscript install_r_packages.R
 # R wants all hidden files gone...
 - rm .gitignore
 - rm .travis.yml
 - rm -rf .git
 - rm -rf ..Rcheck
 - rm .Rprofile

script: 
 - R CMD check .

after_success:
 - Rscript -e 'lintr::lint_package()'
 - Rscript -e 'library(covr); codecov()'
 - Rscript -e 'library(goodpractice); gp()'
 
after_failure:
 - sudo Rscript install_this_r_package.R
 - Rscript -e 'library(Cer2016); testit::assert(has_beast2())'
 - Rscript -e 'lintr::lint_package()'
 - Rscript -e 'library(covr); codecov()'
 - Rscript -e 'library(goodpractice); gp()'
 - cat /home/travis/build/richelbilderbeek/Cer2016/..Rcheck/00install.out
 - cat /home/travis/build/richelbilderbeek/Cer2016/..Rcheck/00check.log
 - cd ~; find . | egrep "beast"
 - cd ~; find . | egrep "\.log"
 - cd ~; find . | egrep "\.trees"
 - cd ~; find . | egrep "\.xml"
 - cd ~; find . | egrep "\.xml\.state"
 - cd ~; find . | egrep "\.fasta"
 - cat /home/travis/build/richelbilderbeek/Cer2016/..Rcheck/tests/testthat/testthat.log
