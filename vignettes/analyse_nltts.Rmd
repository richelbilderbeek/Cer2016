---
title: "Analyse nLTTs"
author: "Richel Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analyse nLTTs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Loading this package

```{r}
library(Cer2016)
```

## Show the distribution of nLTT statistics

```{r}
filenames <- find_paths(paste0("toy_example_", 1:4,".RDa"))
nltt_stats <- calc_nltt_stats_from_files(filenames = filenames, dt = 0.1)
knitr::kable(head(nltt_stats))
```

All on one heap:

```{r fig.width = 7, fig.height = 7}
nltt_stats$sti <- plyr::revalue(nltt_stats$sti, c("1"="youngest", "2"="oldest"))

ggplot2::ggplot(
  data = nltt_stats,
  ggplot2::aes(
    x = nltt_stats$filename,
    y = nltt_stats$nltt_stat
  )
) + ggplot2::geom_boxplot(
) + ggplot2::scale_x_discrete(
  name = "Filename"
) + ggplot2::scale_y_continuous(
  name = "nLTT statistic"
) + ggplot2::ggtitle("Distribution of nLTT statistics")

```

Seperated by species tree:

```{r fig.width = 7, fig.height = 7}
nltt_stats$sti <- plyr::revalue(nltt_stats$sti, c("1"="youngest", "2"="oldest"))

ggplot2::ggplot(
  data = nltt_stats,
  ggplot2::aes(
    x = nltt_stats$filename,
    y = nltt_stats$nltt_stat,
    color = nltt_stats$sti
  )
) + ggplot2::geom_boxplot(
) + ggplot2::scale_x_discrete(
  name = "Filename"
) + ggplot2::scale_y_continuous(
  name = "nLTT statistic"
) + ggplot2::ggtitle("Distribution of nLTT statistics")

```

## Collecting nLTTs from all files

Loading it from file:

```{r}
df_species_trees <- read_collected_nltts_strees()
df_posterior <- read_collected_nltts_postrs()
```

Putting the head of the data frame in a table:

```{r}
knitr::kable(head(df_species_trees))
knitr::kable(tail(df_species_trees))
```

```{r}
knitr::kable(head(df_posterior))
knitr::kable(tail(df_posterior))
```

Here we can see the nLTTs of the species trees used in the analysis:

```{r fig.width = 7, fig.height = 7}

df_species_trees$species_tree <- plyr::revalue(df_species_trees$species_tree, c("1"="youngest", "2"="oldest"))

ggplot2::ggplot(
  data = df_species_trees,
  ggplot2::aes(
    x = df_species_trees$t,
    y = df_species_trees$nltt,
    colour = df_species_trees$filenames,
    shape = df_species_trees$species_tree
  )
) + ggplot2::geom_point(
) + ggplot2::geom_step(direction = "vh", stat = "summary", fun.y = "mean"
) + ggplot2::scale_x_continuous(
  limits = c(0, 1), name = "Time (normalized)"
) + ggplot2::scale_y_continuous(
  limits = c(0, 1), name = "nLTT"
) + ggplot2::ggtitle("Collected species trees")
```

For every parameter combination (in this case summarized as a filename), there are two lines: one for the youngest and
one for the oldest subspiecies to represent a species.

Here we do the same for posteriors:s

```{r fig.width = 7, fig.height = 7}
df_posterior$species_tree <- plyr::revalue(df_posterior$species_tree, c("1"="youngest", "2"="oldest"))

ggplot2::ggplot(
  data = df_posterior,
  ggplot2::aes(
    x = df_posterior$t,
    y = df_posterior$nltt,
    colour = df_posterior$filenames,
    shape = df_posterior$species_tree
  )
) + ggplot2::geom_point(
) + ggplot2::geom_step(direction = "vh", stat = "summary", fun.y = "mean"
) + ggplot2::scale_x_continuous(
  limits = c(0, 1), name = "Time (normalized)"
) + ggplot2::scale_y_continuous(
  limits = c(0, 1), name = "nLTT"
) + ggplot2::ggtitle("Collected posteriors"
) + ggplot2::geom_smooth()
```



```{r fig.width = 7, fig.height = 7}
filenames <- as.vector(sapply(unique(sort(df_species_trees$filenames)), Cer2016::find_path))
for (filename in filenames) {
  #plot_species_tree(filename)
  plot_species_tree_nltt(filename, dt = 0.1)
}
```

```{r fig.width = 7, fig.height = 7}
ggplot2::ggplot(
  data = df_species_trees, 
  ggplot2::aes(x = df_species_trees$t, y = df_species_trees$nltt, colour = df_species_trees$species_tree)
) + ggplot2::geom_point() + ggplot2::geom_smooth()
```



