---
title: "Analyse nLTTs"
author: "Richel Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analyse nLTTs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Loading this package

```{r}
library(Cer2016)
```

Resolution of analysis:

```{r}
dt <- 0.1
```

## Collecting nLTT values from one or more phylogenies

```{r collect_from_phylogenies}
phylogenies <- c(ape::rcoal(10), ape::rcoal(20))
df <- nLTT::get_nltt_values(phylogenies, dt = dt)
knitr::kable(df)
```

## Collecting nLTT values from the species trees

```{r collect_from_species_tree}
filename <- find_path("toy_example_3.RDa")
df <- collect_species_tree_nltts(filename, dt = dt)
testit::assert(names(df) == c("species_tree", "t", "nltt"))
testit::assert(nrow(df) == 2 * (1 + (1 / dt)))
knitr::kable(df)
```

## Collecting nLTT values from the posterior

```{r collect_from_a_file}
filename <- find_path("toy_example_3.RDa")
df <- collect_posterior_nltts(filename, dt = dt)
testit::assert(names(df) == 
  c("species_tree", "alignment", "beast_run", "state", "t", "nltt")
)
testit::assert(nrow(df) == 880)
knitr::kable(head(df))
```

## Collecting nLTTs's from a file

```{r}
filename <- find_path("toy_example_3.RDa")
df <- collect_file_nltts(filename, dt = dt)
testit::assert(names(df) == c("species_tree_nltts", "posterior_nltts"))
testit::assert(
  names(df$species_tree_nltts) == c("species_tree", "t", "nltt")
)
testit::assert(names(df$posterior_nltts) == 
  c("species_tree", "alignment", "beast_run", "state", "t", "nltt")
)
testit::assert(nrow(df$species_tree_nltts) > 0)
testit::assert(nrow(df$posterior_nltts) > 0)
knitr::kable(head(df$species_tree_nltts))
knitr::kable(head(df$posterior_nltts))
```

## Collecting nLTTs from some files

```{r collect_from_some_files}
filenames <- c(
  find_path("toy_example_1.RDa"),
  find_path("toy_example_2.RDa"),
  find_path("toy_example_3.RDa"),
  find_path("toy_example_4.RDa")
)

df <- collect_files_nltts(filenames, dt = dt, verbose = TRUE)
testit::assert(names(df) 
  == c("species_tree_nltts", "posterior_nltts")
)
knitr::kable(head(df$species_tree_nltts))
knitr::kable(head(df$posterior_nltts))
```

## Collecting nLTTs from all files

```{r}
csv_filename_species_trees <- find_path("collected_nltts_species_trees.csv")
csv_filename_posterior <- find_path("collected_nltts_posterior.csv")
testit::assert(file.exists(csv_filename_species_trees))
testit::assert(file.exists(csv_filename_posterior))
```

Loading it from file:

```{r}
df_species_trees <- read.csv(
 file = csv_filename_species_trees, 
 header = TRUE, 
 stringsAsFactors = FALSE, 
 row.names = 1
)

df_posterior <- read.csv(
 file = csv_filename_posterior, 
 header = TRUE, 
 stringsAsFactors = FALSE, 
 row.names = 1
)
```

Putting the head of the data frame in a table:

```{r}
knitr::kable(head(df_species_trees))
```

```{r}
knitr::kable(head(df_posterior))
```

What kind of data is `df_species_trees`?

```{r}
str(df_species_trees)
names(df_species_trees)
```

What kind of data is `df_posterior`?

```{r}
str(df_posterior)
names(df_posterior)
```

Let's first plot the distribution of nLTTs:

```{r}
ggplot2::ggplot(
  data = df_species_trees, ggplot2::aes(df_species_trees$nltt)
) + ggplot2::geom_histogram(binwidth = 1)
```

```{r}
ggplot2::ggplot(
  data = df_posterior, ggplot2::aes(df_posterior$nltt)
) + ggplot2::geom_histogram(binwidth = 1)
```

