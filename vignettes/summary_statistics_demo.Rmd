---
title: "Demo of the summary statistics"
author: "Richel Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Demo of the summary statistics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

There are multiple phylogeny summary statistics:

 * [demo], by Richel
 * [first], by Femke
 * [second], by Jolien
 
## Gamma statistic

The gamma statistic was introduced by Pybus and Harvey (2000).

First, we read a parameter file:

```{r}
library(ape)
library(Cer2016)
filename <- find_path("toy_example_1.RDa")
file <- read_file(filename)
```

A file has some properties:

```{r}
print(names(file))
```

In this example, I /... [TODO]
of the posterior.

The unsampled original species tree is in `file$pbd_output`, let's
see what's there:

```{r}
print(names(file$pbd_output))
```

The incipient species tree is in `file$species_tree_with_outgroup`, let's
plot it:

```{r}
incipient_species_tree <- file$pbd_output$igtree.extant
colors <- setNames(c("gray","black"),c("i","g"))
phytools::plotSimmap(
  incipient_species_tree, 
  colors = colors
)
```

I will use that tree as my true tree (sorry for all those square
brackets):

```{r}
true_tree <- file$species_trees_with_outgroup[[1]][[1]]
plot(true_tree)
```

Here I use the `gamma` statistic:

 * `gamma < 0`: a tippy tree
 * `gamma > 0`: a stemmy tree

```{r}
true_gamma <- gammaStat(true_tree)
print(true_gamma)
```

The question is: how is the distribution of that statistic in the posterior?

```{r}
posterior_filename <- find_path("toy_example_1_1_1_1.trees")
posterior_trees <- rBEAST::beast2out.read.trees(posterior_filename)
n_trees <- length(posterior_trees)
```

For giggles, let's plot all 10 posterior trees:

```{r}
for (i in seq(1:n_trees)) {
  plot(posterior_trees[[i]])
}
```

From those posterior trees, we collect the gamma statistic:

```{r}
gamma_statistics <- rep(0, times = n_trees)
for (i in seq(1:n_trees)) {
  gamma_statistics[i] <- gammaStat(posterior_trees[[i]])
}
hist(gamma_statistics, xlim = c(-1,1))
abline(v = true_gamma, col = "red")
```

It appears that all gamma statistics in the posterior are lower than the gamma statistic
of the true tree.

## Colless statistic [DOES NOT WORK]

The Colless statistic was introduced by Colless (1982).

First, we read a parameter file:

```
library(ape)
library(Cer2016)
library(phytools)
library(apTreeshape) # For colless
filename <- find_path("toy_example_1.RDa")
file <- read_file(filename)
```

I will use that tree as my true tree (sorry for all those square
brackets):

```
true_tree <- file$species_trees_with_outgroup[[1]][[1]]
plot(true_tree)
```

This does not work:

```
true_colless  <- colless(true_tree)
print(true_colless)
```

It does not work as `colless` needs a `apTreeShape` (from the `apTreeShape`
package). Also their PPtree example is unclear to me:

```
library(PPtree)
data(iris)
n <- nrow(iris)
tot <- c(1:n)
n.train <- round(n*0.9)
train <- sample(tot,n.train)
test <- tot[-train]
 
Tree.result <- PDA.Tree(iris[train,5],iris[train,1:4])
Tree.result
plot(Tree.result$Tree.Struct)
```

## [First summary statistic]

Given a phylogeny [TODO: Use a BD or PBD phylogeny]

```{r}
library(ape)
phylogeny <- rcoal(10)
plot(phylogeny)
```

A possible summary statistic is ...

The statistic is very in-/sensitive, as when we compare the phylogeny
to itself, the values already differ????

```{r}
measurement_1 <- runif(n = 1, max = sum(phylogeny$edge.length))
measurement_2 <- runif(n = 1, max = sum(phylogeny$edge.length))
print(measurement_1)
print(measurement_2)
```






