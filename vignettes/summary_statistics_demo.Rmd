---
title: "Demo of the summary statistics"
author: "Richel Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Demo of the summary statistics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

There are multiple phylogeny summary statistics:

 * [Femke and Jolien summary statistic]
 * Gamma statistic
 * Colless statistic
 
First it is shown how a parameter file is built up, then 
the individual summary statistics are shown

## Parameter file build-up

For this vignette, we need these libraries:

```{r}
library(ape)
library(Cer2016)
options(warn = 2)
```

First we obtain the full path of a parameter file:

```{r}
filename <- find_path("toy_example_1.RDa")
print(filename)
```

This path will be different: Windows users will have a path starting
with `C:/` or `D:/` or higher. GNU/Linux users will have a UNIX
path.

The function `read_file` reads the file (it also checks
if the file does indeed exist):

```{r}
file <- read_file(filename)
```

`file`, which is a file, has a (hopefully) convenient structure.
This structure can be observed using `names`:

```{r}
print(names(file))
```

The (unsampled) (original) incipient species tree is 
in `file$pbd_output`, let's see what's there:

```{r}
print(names(file$pbd_output))
```

The (unsampled) (original) incipient species tree is 
in `file$species_tree`, let's plot it:

```{r}
incipient_species_tree <- file$pbd_output$igtree.extant
colors <- setNames(c("gray", "black"), c("i","g"))
phytools::plotSimmap(
  incipient_species_tree, 
  colors = colors
)
```

I chose to plot the incipient species tree for extant
species, thus `igtree.extant`. Because an incipient
species trees has states on the edges (`good` and
`incipient`), it is not a phylogeny of class `phylo`
but has additional data as well. 

## Femke and Jolien summary statistic

## Gamma statistic

The gamma statistic was introduced by Pybus and Harvey (2000).

 * `gamma < 0`: a tippy tree
 * `gamma > 0`: a stemmy tree

The incipient species tree looks like this:

```{r}
colors <- stats::setNames(c("gray", "black"), c("i", "g"))
testit::assert(length(read_file(filename)$pbd_output$igtree.extant$tip.label) > 0)
phytools::plotSimmap(
  file$pbd_output$igtree.extant, 
  colors = colors
)
```

I will use a sampled species tree as my true tree:

```{r}
true_tree <-get_species_tree_by_index(file = file, sti = 1)
plot(true_tree)
```

Note that `[[1]][[1]]`: it allows for multiple sampled species trees
for more complex parameter files, but here it just looks ugly.

From that true tree, I measure the gamma statistic:

```{r}
true_gamma <- ape::gammaStat(true_tree)
print(true_gamma)
if (true_gamma < 0) {
  print("tippy tree")
} else {
  print("stemmy tree")
}  
```

The question is: how is the distribution of that statistic in the posterior?

This toy example has only one posterior file:


Extracting the trees from that posterior:

```{r}
posterior_trees <- get_posteriors(file)[[1]][[1]]$trees
n_trees <- length(posterior_trees)
print(paste0("There are ", n_trees))
```

For giggles, let's plot all 10 posterior trees:

```{r}
for (i in seq(1:n_trees)) {
  plot(posterior_trees[[i]])
}
```

From those posterior trees, we collect the gamma statistic:

```{r}
gamma_statistics <- rep(0, times = n_trees)
for (i in seq(1:n_trees)) {
  gamma_statistics[i] <- ape::gammaStat(posterior_trees[[i]])
}
hist(gamma_statistics, xlim = c(-1,1))
abline(v = true_gamma, col = "red")
```

It appears that all gamma statistics in the posterior are lower than the gamma statistic
of the true tree.

## Colless statistic [DOES NOT WORK]

The Colless statistic was introduced by Colless (1982).

First, we read a parameter file:

```
library(ape)
library(Cer2016)
library(phytools)
library(apTreeshape) # For colless
filename <- find_path("toy_example_1.RDa")
file <- read_file(filename)
```

I will use that tree as my true tree (sorry for all those square
brackets):

```
true_tree <- get_species_tree_by_index(file = file, sti = 1)
plot(true_tree)
```

This does not work:

```
true_colless  <- colless(true_tree)
print(true_colless)
```

It does not work as `colless` needs a `apTreeShape` (from the `apTreeShape`
package). Also their PPtree example is unclear to me:

```
library(PPtree)
data(iris)
n <- nrow(iris)
tot <- c(1:n)
n.train <- round(n*0.9)
train <- sample(tot, n.train)
test <- tot[-train]
 
Tree.result <- PDA.Tree(iris[train,5], iris[train,1:4])
Tree.result
plot(Tree.result$Tree.Struct)
```

## [First summary statistic]

Given a phylogeny [TODO: Use a BD or PBD phylogeny]

```{r}
library(ape)
phylogeny <- rcoal(10)
plot(phylogeny)
```

A possible summary statistic is ...

The statistic is very in-/sensitive, as when we compare the phylogeny
to itself, the values already differ????

```{r}
measurement_1 <- stats::runif(n = 1, max = sum(phylogeny$edge.length))
measurement_2 <- stats::runif(n = 1, max = sum(phylogeny$edge.length))
print(measurement_1)
print(measurement_2)
```






