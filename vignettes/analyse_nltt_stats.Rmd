---
title: "Analyse nLTT statistics"
author: "Richel Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analyse nLTTs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Abstract

This vignette shows how analyse the nLTT statistics.

## Setup

Loading this package

```{r}
library(Cer2016)
library(dplyr)
library(tidyr)
options(warn = 2)
```

## Show the distribution of nLTT statistics

```{r}
nltt_stats_raw <- read_collected_nltt_stats()
#nltt_stats_raw$sti <- plyr::revalue(nltt_stats_raw$sti, c("1"="youngest", "2"="oldest"))
knitr::kable(head(nltt_stats_raw, 12))
```

Remove the NA's:

```{r}
nltt_stats <- nltt_stats_raw[!is.na(nltt_stats_raw$nltt_stat), ]
```

## Are nLTT statistics from the same distribution?

Time to anwer the question [do nLTT statistics differ between posteriors?](https://github.com/richelbilderbeek/Cer2016/issues/103)

First we need to know if nLTT statistics are from the
same distribution, as this will influence are tests.

To do, we will use the Mann-Whitney U test, as
it assumes little.

Are nLTT statistics between BEAST2 runs from the same
distribution?

```{r}
df <- are_beast_replicates_from_same_distribution(nltt_stats)
count(df, filename)
df[ is.na(df$filename), ]

head(df)
df_false <- df[ df$same_distr == FALSE, ]
df_na <- df[ is.na(df$same_distr), ]

knitr::kable(head(df))
knitr::kable(count(df, same_distr))
```



## Show all nLTTs

All on one heap:

```{r fig.width = 7, fig.height = 7}
if (1 == 2) {
  ggplot2::ggplot(
    data = nltt_stats,
    ggplot2::aes(
      x = nltt_stats$filename,
      y = nltt_stats$nltt_stat
    )
  ) + ggplot2::geom_boxplot(
  ) + ggplot2::scale_x_discrete(
    name = "Filename"
  ) + ggplot2::scale_y_continuous(
    name = "nLTT statistic"
  ) + ggplot2::ggtitle("Distribution of nLTT statistics") + 
    ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90, vjust = 0.5)) + ggplot2::theme(legend.position="none") + 
    ggplot2::theme(axis.ticks = ggplot2::element_blank(), axis.text.x = ggplot2::element_blank())
}
```
