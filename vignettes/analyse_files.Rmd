---
title: "Analyse files"
author: "Richel Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analyse files}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Loading this package

```{r}
library(Cer2016)
```

Extracting all file parameters is easy:

```{r}

csv_filename <- find_path("collected_parameters.csv")
if (!file.exists(csv_filename)) {
  folder <- "/home/p230198/Peregrine"
  all_parameter_filenames <- paste(folder, list.files(folder, pattern = "\\.RDa"), sep = "/")
  df <- collect_parameters(all_parameter_filenames, verbose = TRUE)
  write.csv(
    x = df,
    file = csv_filename,
    row.names = TRUE
  )
}
```

Note that the comma-seperated file is only created when absent,
as this is a long step.

Loading it from file:

```{r}
df <- read.csv(
  file = csv_filename, 
  header = TRUE, 
  stringsAsFactors = FALSE, 
  row.names = 1
)
```

Number of filenames: `r nrow(df)`

Putting the head of the data frame in a table:

```{r}
knitr::kable(head(df))
```

What kind of data is `df`?

```{r}
str(df)
names(df)
```

If an incipient species tree is simulated for a
longer time, I expect it to have more branches, thus
making the next steps harder, thus causing a 
BEAST2 run to take too long.

Let's check this:

```{r}
ggplot2::ggplot(data = df, ggplot2::aes(df$age)) + ggplot2::geom_histogram(binwidth = 1)
```

Age appears not to be very predictive if a simulation will succeed.

If an alignment is simulated for more nucleotides, 
I expect a BEAST2 run to take longer, thus likelier
to crash.

Let's check this:

```{r}
ggplot2::ggplot(data = df, ggplot2::aes(df$sequence_length)) + ggplot2::geom_histogram()
```

Now on a log scale:

```{r}
ggplot2::ggplot(data = df, ggplot2::aes(df$sequence_length)) + ggplot2::geom_histogram() + ggplot2::scale_x_log10()
```

Now as a `freq_poly` on a log scale:

```{r}
ggplot2::ggplot(data = df, ggplot2::aes(df$sequence_length)) + ggplot2::geom_freqpoly() + ggplot2::scale_x_log10()
```

## Correct file I/O with `.csv`

Here I tested how to do correct file I/O by write to a `.csv`
and then loading from that `.csv`.

```{r}
csv_filename <- "analyse_files_test.csv"
df_in <- data.frame(
  x = c(1, 2, 3), y = c(1, 4, 9)
)
rownames(df_in) <- c("a.txt","b.txt","c.txt")
print(rownames(df_in))
knitr::kable(head(df_in))
```

The table should show column and row names in bold.

Saving:

```{r}
write.csv(x = df_in, file = csv_filename, row.names = TRUE)
```

Loading:

```{r}

df_out <- read.csv(file = csv_filename, 
  header = TRUE, 
  stringsAsFactors = FALSE, 
  row.names = 1
)
knitr::kable(head(df_out))
```

No idea why `row.names = 1` works, and `row.names = TRUE` not...
