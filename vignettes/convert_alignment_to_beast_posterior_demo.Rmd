---
title: "alignment_to_beast_posterior demo"
author: "Richel Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{alignment_to_beast_posterior demo}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

To convert an alignment to a BEAST2 posterior:

 * Create a phylogeny
 * Create an alignment from that phylogeny
 * Create a BEAST2 posterior from that alignment
 * Compare the BEAST2 posterior with the original phylogeny

## Load the packages

```{r message = FALSE, warning = FALSE}
library(Cer2016)
library(nLTT)
library(phangorn)
library(rBEAST)
library(testit)
```

Check if BEAST2 can be found:

```{r}
find_beast_jar_path()
```

## Create a phylogeny

```{r}
n_taxa <- 5
phylogeny <- ape::rcoal(n = n_taxa)
plot(phylogeny)
```

## Create an alignment from that phylogeny

```{r}
alignment <- convert_phylogeny_to_alignment(
  phylogeny = phylogeny,
  sequence_length = 10
)
image(alignment)
```

From that alignment, create a BEAST2 posterior

```{r}
base_filename <- "alignment_to_beast_posterior_test"

if (file.exists(paste(base_filename, ".log", sep = ""))) {
  file.remove(paste(base_filename, ".log", sep = ""))  
}
if (file.exists(paste(base_filename, ".trees", sep = ""))) {
  file.remove(paste(base_filename, ".trees", sep = ""))  
}
if (file.exists(paste(base_filename, ".xml.state", sep = ""))) {
  file.remove(paste(base_filename, ".xml.state", sep = ""))  
}
posterior <- alignment_to_beast_posterior(
  alignment,
  mcmc_chainlength = 10000,
  base_filename = base_filename,
  rng_seed = 42,
  beast_bin_path = "",
  beast_jar_path = find_beast_jar_path()
)
```

## Plot this posterior

Here the posterior phylogenies are plotted:

```{r warning = FALSE}
# To get the densiTree function working, phylogenies must be of class multiphylo
class(posterior) <- "multiPhylo"
```

Displaying:

```{r fig.width = 7, fig.height = 7}
densiTree(
  posterior, 
  type = "cladogram",
  alpha = 1
)
```


## Cleanup

```{r message = FALSE}
if (file.exists(paste(base_filename, ".log", sep = ""))) {
  file.remove(paste(base_filename, ".log", sep = ""))  
}
if (file.exists(paste(base_filename, ".trees", sep = ""))) {
  file.remove(paste(base_filename, ".trees", sep = ""))  
}
if (file.exists(paste(base_filename, ".xml.state", sep = ""))) {
  file.remove(paste(base_filename, ".xml.state", sep = ""))  
}
```
